var stateEngine,map,directions,changeRoute;$(window).on("load",function(){var t=[-122.44590863123258,37.767478083760864],e=[-122.4471046599675,37.77094470398184],o=[-122.4729874800642,37.763923871626076],i=[-122.47455778282995,37.763678651375386],n=.001;mapboxgl.accessToken="pk.eyJ1Ijoic2Nvb3R0ZWNoIiwiYSI6IlBMTjNqVTgifQ.r8a_cZRmGF_GIOKIKaK1dA";var a=new mapboxgl.Map({container:"map",style:"mapbox://styles/scoottech/cj9fxafpl8gmx2spf6exr13dg",center:[o[0],o[1]-.001],zoom:15,minZoom:11,dragRotate:!1}),r=$("#destination"),s=$(".drawer-top-bar span"),c=$(".scoot-options-container"),l=$("#trip-bar"),d=$("#reserve-btn"),g=$("#title"),u=$("#title h1"),p=$("#garage"),y=$("#clicker");l.velocity("slideUp",{duration:250}),p.velocity("slideUp",{duration:250});var f=function(){$("#splash").fadeOut(300)},m={"icon-image":"scoot-batt-high","icon-size":{stops:[[14,.4],[16,1]]}},v={"icon-image":"pickup-inactive","icon-size":{stops:[[13,.4],[15,1],[18,1.5]]}},x={"icon-image":"star","text-field":"Your Destination","text-size":12,"text-anchor":"bottom","text-offset":{stops:[[14,[0,2]],[16,[0,5]]]},"icon-size":{stops:[[14,.4],[16,1]]}},w={"icon-image":"gps","icon-size":{stops:[[14,.3],[16,.8]]}},b=function(t,e,o,i){var n=turf.featureCollection([turf.point(o)]);a.addLayer({id:t,type:e,source:{type:"geojson",data:n},layout:i})},k=function(){b("startScoot","symbol",o,m),b("garage","symbol",e,v),b("destination","symbol",t,x),b("gps","symbol",i,w)};stateEngine={reserveDrawer:!1,rideMode:!1,walkingPath:!1,garageSelected:!1};var h=function(){c.velocity("slideDown",{duration:800,easing:[250,18]}),stateEngine.reserveDrawer=!0,a.setLayoutProperty("startScoot","icon-size",{stops:[[14,.6],[16,1.2]]})},L=function(){c.velocity("slideUp",{duration:200}),a.setLayoutProperty("startScoot","icon-size",{stops:[[14,.4],[16,1]]}),a.setLayoutProperty("startScoot","icon-image","scoot-batt-high"),stateEngine.reserveDrawer=!1,E()},S=function(){stateEngine.rideMode=!0,z()},z=function(){l.velocity("slideDown",{duration:500}),d.velocity("callout.pulse",{delay:500}).text("turn on"),g.velocity({backgroundColor:"#ccc"},{duration:500}),u.text("Reserved! Billing starts in 15 minutes"),a.setLayoutProperty("startScoot","icon-image","ride-mode-scoot"),a.setLayoutProperty("startScoot","icon-size",{stops:[[14,.8],[16,1]]}),a.setLayoutProperty("garage","icon-image","parking-inactive"),$("#info-2").text("Billing starts"),$("#cost").text("$4.00");var t=moment().add(15,"m").format("LT");$("#timer").text(t)},E=function(){l.velocity("slideUp",{duration:200}),d.text("Reserve"),g.velocity({backgroundColor:"#fff"},{duration:0}),u.text("Street Parked Scoot"),a.setLayoutProperty("startScoot","icon-image","scoot-batt-high"),a.setLayoutProperty("startScoot","icon-size",{stops:[[14,.4],[16,1]]}),$("#info-2").text("Walking Dist"),$("#cost").text("$3 - 4"),$("#timer").text("1 min"),stateEngine.rideMode=!1,a.setLayoutProperty("garage","icon-image","pickup-inactive")},P=function(){p.velocity("slideDown",{duration:250})};a.on("load",function(){f(),k(),a.on("click",function(t){var e=[t.lngLat.lng,t.lngLat.lat],o=a.queryRenderedFeatures(t.point)[0],i=o.layer.id;console.log(o,i),"garage"===i&&!0===stateEngine.rideMode&&P(),"startScoot"===i&&!1===stateEngine.reserveDrawer&&!1===stateEngine.rideMode&&h()})}),$(".location-btn").click(function(){a.flyTo({center:[i[0],i[1]-.001],zoom:15})}),$("#close-drawer").click(function(){stateEngine.rideMode?window.confirm("Do you want to cancel your reservation and start again?")&&L():L()}),d.click(function(){stateEngine.rideMode?window.alert("turned on scoot"):S()}),y.click(function(){console.log("hey!"),p.velocity("slideUp",{duration:250}),$("#cost").text("$3.00")})});